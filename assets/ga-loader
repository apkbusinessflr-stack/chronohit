// Lightweight GA4 dynamic loader (no frameworks)
// Reads GA_MEASUREMENT_ID from /api/ga-config and injects the GA tag.
// Place this script in <head> of each page:
//   <script src="./assets/ga-loader.js"></script>
// or on the game page:
//   <script src="../../assets/ga-loader.js"></script>

(async function initGA(){
  try {
    const res = await fetch('/api/ga-config');
    const cfg = await res.json();
    if (!cfg || !cfg.enabled || !cfg.id) return; // GA not configured

    // Inject GA library
    const s = document.createElement('script');
    s.async = true;
    s.src = `https://www.googletagmanager.com/gtag/js?id=${encodeURIComponent(cfg.id)}`;
    document.head.appendChild(s);

    // Bootstrap gtag
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    window.gtag = window.gtag || gtag;
    gtag('js', new Date());
    gtag('config', cfg.id, { anonymize_ip: true });
  } catch (e) {
    // no-op if offline or API missing
  }
})();
